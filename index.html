<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Titanic Binary Classifier (TF.js)</title>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root { --bg:#0b1020; --card:#121836; --muted:#9bb0d1; --text:#e9efff; }
    *{box-sizing:border-box} html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
    header{padding:24px 16px;text-align:center}
    header h1{margin:0 0 6px;font-size:clamp(22px,4vw,32px)}
    header p{margin:0;color:var(--muted)}
    .container{width:min(1100px,92vw);margin:0 auto 80px;display:grid;gap:16px}
    .card{background:linear-gradient(180deg,#121836,#0f1430);border:1px solid #2a3569;border-radius:16px;padding:16px}
    .card h2{margin:0 0 10px;font-size:18px}
    .muted{color:var(--muted)} .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    input[type=file]{padding:8px 10px;border:1px dashed #33407a;border-radius:12px;background:#0c1130;color:var(--muted)}
    .btn{border:0;border-radius:12px;padding:10px 14px;background:#2e57a4;color:#fff;font-weight:600;cursor:pointer}
    .btn.secondary{background:#2e8f72} .btn.danger{background:#a43e3e}
    .vis{background:#0e1537;border:1px solid #24306b;border-radius:10px;padding:8px;min-height:140px;overflow:auto}
    table{width:100%;border-collapse:collapse;border:1px solid #263168;border-radius:12px;overflow:hidden;font-size:13px}
    th,td{border-bottom:1px solid #232c59;padding:8px 10px;text-align:left}
    th{background:#0e1537;color:#bcd0ff} tbody tr:nth-child(even){background:#0d1332}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px} @media(max-width:980px){.grid2{grid-template-columns:1fr}}
    .slider-row{display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:center}
    input[type=range]{width:100%}
    .tag{display:inline-block;padding:3px 8px;border-radius:999px;background:#142157;border:1px solid #2b3e8a;color:#cfe0ff;font-size:12px}
  </style>
</head>
<body>
<header>
  <h1>Titanic Binary Classifier — TensorFlow.js (Shallow NN)</h1>
  <p>Load CSVs, preprocess in-browser, train with live charts (ROC/AUC), export predictions. No server.</p>
</header>

<main class="container">
  <!-- DATA -->
  <section class="card">
    <h2>Data Load</h2>
    <p>Choose <span class="tag">train.csv</span> (with Survived) and optional <span class="tag">test.csv</span>. Robust CSV parsing.</p>
    <div class="row">
      <label class="tag">Train CSV</label><input type="file" id="trainFile" accept=".csv">
      <label class="tag">Test CSV</label><input type="file" id="testFile" accept=".csv">
      <button class="btn" id="btnLoad">Load & Inspect</button>
      <button class="btn danger" id="btnReset">Reset</button>
    </div>
    <div class="grid2" style="margin-top:12px">
      <div><h3 class="muted">Preview (train)</h3><div id="trainPreview" class="vis"></div></div>
      <div><h3 class="muted">Info</h3><div id="datasetInfo" class="vis mono"></div></div>
    </div>
    <div class="grid2" style="margin-top:12px">
      <div><h3 class="muted">Survival by Sex</h3><div id="barSex" class="vis"></div></div>
      <div><h3 class="muted">Survival by Pclass</h3><div id="barPclass" class="vis"></div></div>
    </div>
  </section>

  <!-- PREPROCESS -->
  <section class="card">
    <h2>Preprocessing</h2>
    <p>Age→median, Embarked→mode, standardize Age/Fare, one-hot Sex/Pclass/Embarked. Optional: FamilySize, IsAlone.</p>
    <div class="row">
      <label><input type="checkbox" id="toggleFamily" checked> Add FamilySize</label>
      <label><input type="checkbox" id="toggleIsAlone" checked> Add IsAlone</label>
      <button class="btn secondary" id="btnPreprocess">Run Preprocessing</button>
    </div>
    <div id="preOut" class="vis mono" style="margin-top:10px"></div>
  </section>

  <!-- MODEL -->
  <section class="card">
    <h2>Model</h2>
    <p>Dense(16,'relu') → Dense(1,'sigmoid'), optimizer <span class="tag">adam</span>, loss <span class="tag">binaryCrossentropy</span>, metric <span class="tag">accuracy</span>.</p>
    <div class="row">
      <button class="btn" id="btnBuild">Build Model</button>
      <button class="btn" id="btnSummary">Show Summary</button>
    </div>
    <div id="modelSummary" class="vis mono" style="margin-top:10px"></div>
  </section>

  <!-- TRAIN -->
  <section class="card">
    <h2>Training</h2>
    <p>80/20 stratified split, 50 epochs, batch 32, early stopping (patience=5). Charts appear in the tfjs-vis visor.</p>
    <div class="row">
      <button class="btn" id="btnTrain">Train</button>
      <span id="trainStatus" class="mono muted"></span>
    </div>
    <div class="grid2" style="margin-top:12px">
      <div><h3 class="muted">Loss (visor)</h3><div id="lossContainer" class="vis"></div></div>
      <div><h3 class="muted">Accuracy (visor)</h3><div id="accContainer" class="vis"></div></div>
    </div>
  </section>

  <!-- METRICS -->
  <section class="card">
    <h2>Metrics</h2>
    <div class="grid2">
      <div>
        <h3 class="muted">ROC Curve</h3>
        <div id="rocContainer" class="vis"></div>
        <div id="aucNote" class="muted mono" style="margin-top:6px"></div>
      </div>
      <div>
        <h3 class="muted">Threshold & Confusion Matrix</h3>
        <div class="slider-row">
          <span class="mono muted">0.00</span>
          <input type="range" id="thrSlider" min="0" max="1" step="0.01" value="0.5">
          <span class="mono muted">1.00</span>
        </div>
        <div style="margin-top:6px" class="mono">Threshold: <span id="thrVal" class="tag">0.50</span></div>
        <div id="cmContainer" class="vis mono" style="margin-top:8px"></div>
        <div id="prfContainer" class="vis mono" style="margin-top:8px"></div>
      </div>
    </div>
  </section>

  <!-- PREDICT -->
  <section class="card">
    <h2>Prediction & Export</h2>
    <div class="row">
      <button class="btn secondary" id="btnPredict">Predict</button>
      <button class="btn" id="btnExportSub">Export submission.csv</button>
      <button class="btn" id="btnExportProbs">Export probabilities.csv</button>
      <button class="btn" id="btnSaveModel">Download Model</button>
    </div>
    <div id="predictNote" class="muted" style="margin-top:8px"></div>
  </section>

  <!-- DEPLOY -->
  <section class="card">
    <h2>Deployment Notes</h2>
    <ul>
      <li>Create a public GitHub repo.</li>
      <li>Add <span class="mono">index.html</span> and <span class="mono">app.js</span>.</li>
      <li>Enable GitHub Pages → Branch: <b>main</b>, Folder: <b>/ (root)</b>.</li>
      <li>Open the URL and test.</li>
    </ul>
  </section>
</main>

<script src="./app.js"></script>
</body>
</html>
